@model ShoppingCart

@{
    var totalItems = Model.Items.Sum(i => i.Quantity);
    var totalPrice = Model.Items.Sum(i => i.SubTotal);
}

<div class="mini-cart-container position-relative">

    @* PHẦN 1: ICON VÀ SỐ LƯỢNG ĐỂ CLICK *@
    <a asp-controller="Cart" asp-action="Index" class="position-relative text-white text-decoration-none" id="cartIconLink">
        <i class="fa-solid fa-cart-shopping fs-5"></i>
        @if (totalItems > 0)
        {
            <span id="cart-count" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                @totalItems
            </span>
        }
    </a>

    @* PHẦN 2: DROPDOWN MENU ĐỂ HOVER *@
    <div class="dropdown-menu dropdown-menu-end p-0 shadow mini-cart-dropdown" style="width: 400px; display: none; position: absolute; left: -300px">
        @if (Model.Items.Any())
        {
            <div class="p-3">
                <h6 class="mb-0">Giỏ hàng của bạn</h6>
            </div>
            <div class="dropdown-divider m-0"></div>

            <div id="mini-cart-items" style="max-height: 300px; overflow-y: auto;">
                @foreach (var item in Model.Items)
                {
                    <div class="d-flex align-items-center p-3 border-bottom" id="item-@item.VariantId">
                        <img src="@(item.ImageUrl ?? "/images/placeholder.png")" width="60" class="me-3 rounded" />
                        <div class="flex-grow-1">
                            <h6 class="mb-0 small">@item.ProductName</h6>
                            <p class="mb-1 text-muted small">@item.VariantDescription</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <input type="number" class="form-control form-control-sm update-cart-qty" style="width: 60px;"
                                       value="@item.Quantity" min="1" data-id="@item.VariantId">
                                <span class="fw-bold small" id="subtotal-@item.VariantId">@item.SubTotal.ToString("N0")đ</span>
                            </div>
                        </div>
                        <button type="button" class="btn-close ms-3 remove-from-cart" aria-label="Close" data-id="@item.VariantId"></button>
                    </div>
                }
            </div>

            <div class="p-3">
                <div class="d-flex justify-content-between my-2">
                    <strong>Tổng cộng:</strong>
                    <strong id="mini-cart-total">@totalPrice.ToString("N0")đ</strong>
                </div>
                <a class="btn btn-primary w-100" asp-controller="Cart" asp-action="Index">Xem Giỏ Hàng & Thanh toán</a>
            </div>
        }
        else
        {
            <div class="text-center p-5">
                <i class="fa-solid fa-cart-plus fs-1 text-muted mb-3"></i>
                <h6>Giỏ hàng của bạn đang trống.</h6>
            </div>
        }
    </div>
</div>