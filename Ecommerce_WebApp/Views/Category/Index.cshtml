@using Ecommerce_WebApp.ViewModels
@model CategoryPageVM
@{
    ViewData["Title"] = Model.MainCategory.Name;
}

<div class="container my-4">
    <!-- ICON DANH MỤC ĐỘNG -->
    <div class="d-flex justify-content-center flex-wrap gap-4">
        @foreach (var rootCat in Model.RootCategories)
        {
            <div class="text-center">
                <a asp-controller="Category" asp-action="Index" asp-route-id="@rootCat.Id">
                    <img src="@(rootCat.IconUrl ?? "/images/placeholder.png")" alt="@rootCat.Name" class="img-fluid icon-small img-hover-zoom" />
                </a>
            </div>
        }
    </div>
</div>


<div class="container">
    <!--BREADCRUMB ĐỘNG-->
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li><i class="fa fa-home me-3"></i></li>
            <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">Trang chủ</a></li>
            @if (Model.MainCategory.Parent != null)
            {
                <li class="breadcrumb-item"><a asp-controller="Category" asp-action="Index" asp-route-id="@Model.MainCategory.Parent.Id">@Model.MainCategory.Parent.Name</a></li>
            }
            <li class="breadcrumb-item active" aria-current="page">@Model.MainCategory.Name</li>
        </ol>
    </nav>

    <h2 class="text-center fs-5">
        MacStore – Máy tính/Laptop đẳng cấp, sang trọng dành cho bạn
    </h2>
    <p><strong>Thương hiệu Apple</strong> chắc sẽ không phải là cái tên xa lạ đối với mọi người. Những sản phẩm mang tính cách mạng và dẫn đầu xu hướng của Apple như <strong>iPod, iPhone, iMac, Macbook Pro, Macbook Air, Mac Studio, Mac Mini, Mac Pro</strong>…. Đối với thị phần ở Việt Nam thì Apple ngày càng được mọi người đón nhận mỗi khi ra sản phẩm mới. Một trong những sản phẩm dẫn đầu xu hướng đó là <strong>Macbook</strong>.</p>
    <p>Macbook mới nhập khẩu chính hãng bởi nhà phân phối, đầy đủ chứng từ nguồn gốc xuất xứ, giá đã bao gồm thuế VAT. Bảo hành đổi mới 30 ngày tại Macstore và 12 tháng bởi nhà phân phối.</p>

    <div>
        <a>
            <h1 class="fs-5 fw-bold">@Model.MainCategory.Name</h1>
        </a>

        @* BỘ LỌC GIÁ *@
        <div class="dropdown mb-3">
            @* Nút bấm chính để mở dropdown *@
            <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="priceFilterDropdown" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false">
                <i class="fas fa-dollar-sign me-2"></i>
                @if (Model.MaxPriceSelected.HasValue)
                {
                    <span>Lọc theo giá: Dưới @Model.MaxPriceSelected.Value.ToString("N0")đ</span>
                }
                else
                {
                    <span>Chọn khoảng giá</span>
                }
            </button>

            @* Nội dung của dropdown menu *@
            <div class="dropdown-menu p-4" aria-labelledby="priceFilterDropdown" style="width: 350px;">
                <form asp-action="Index" asp-route-id="@Model.MainCategory.Id" method="get">
                    <div class="mb-3">
                        <label for="priceRange" class="form-label fw-bold">Kéo để chọn mức giá tối đa</label>
                        <div class="d-flex justify-content-between text-muted small">
                            <span>@Model.MinPriceAvailable.ToString("N0")đ</span>
                            <span>@Model.MaxPriceAvailable.ToString("N0")đ</span>
                        </div>
                        <input type="range" class="form-range" id="priceRange"
                               name="maxPrice"
                               min="@Model.MinPriceAvailable"
                               max="@Model.MaxPriceAvailable"
                               step="1000000"
                               value="@(Model.MaxPriceSelected ?? Model.MaxPriceAvailable)">
                        <div class="text-center mt-2 fw-bold" style="color: var(--bs-primary);">
                            Dưới <span id="priceValue">@((Model.MaxPriceSelected ?? Model.MaxPriceAvailable).ToString("N0"))</span> đ
                        </div>
                    </div>

                    <div class="d-flex justify-content-between">
                        <a asp-action="Index" asp-route-id="@Model.MainCategory.Id" class="btn btn-warning btn-outline-dark text-white">Xóa lọc</a>
                        <button type="submit" class="btn btn-sm btn-primary">Áp dụng</button>
                    </div>
                </form>
            </div>
        </div>
        </div>

        <div class="row g-0 text-center" id="filterGrid">
            <a asp-controller="Category" asp-action="Index" asp-route-id="@Model.ParentCategoryForFilter?.Id"
               class="col filter-item p-3 text-dark text-decoration-none @(Model.MainCategory.Id == Model.ParentCategoryForFilter?.Id ? "active" : "")">
                Tất cả
            </a>

            @foreach (var subCat in Model.SubCategories)
            {
                <a asp-controller="Category" asp-action="Index" asp-route-id="@subCat.Id"
                   class="col filter-item p-3 text-dark text-decoration-none @(subCat.Id == Model.MainCategory.Id ? "active" : "")">
                    @subCat.Name
                </a>
            }
        </div>

        <!-- DANH SÁCH SẢN PHẨM -->
        <div class="container p-3 py-5 bg-white shadow-sm">
            <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4">
                @if (Model.Products.Any())
                {
                    @foreach (var product in Model.Products)
                    {
                        <partial name="_ProductCard" model="product" />
                    }
                }
                else
                {
                    <div class="col-12 text-center">
                        <p class="mt-4">Không có sản phẩm nào trong danh mục này.</p>
                    </div>
                }
            </div>
        </div>


        <div class="container p-0 mt-4">
            <h2 class="text-center">Khách hàng mua hàng tại Macstores.vn</h2>
            <div class="text-center">
                <img  src="https://macstores.vn/wp-content/uploads/2024/01/khach-hang-mua-san-pham-tai-cua-hang-macstores.vn_.jpg" alt="Macstores.vn chân thành cảm ơn Quý Khách Hàng đã tin tưởng"/>
                <p>
                    Khách hàng mua sản phẩm tại Macstores.vn</p></div>
            <p><strong>TRUNG TÂM MUA SẮM MACSTORE – TRUNG TÂM MUA SẮM MAC – LAPTOP UY TÍN</strong></p>
            <ul>
                <li>Hotline: <a href="http://0935023023">0879723014</a> (24/7)</li>
            <li>Email: <a href="anhtai26072004@gmail.com">anhtai26072004@gmail.com</a></li>
            <li>Website: <a href="#">macstoreclone.vn</a></li>
                <li>Cửa hàng: <a href="#">132, Lê Lai, P. Bến Thành, Quận 1, thành phố Hồ Chí Minh</a></li>
            </ul>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        // === SCRIPT CHO BỘ LỌC GIÁ ===
        document.addEventListener("DOMContentLoaded", function () {
            const priceRange = document.getElementById('priceRange');
            const priceValue = document.getElementById('priceValue');

            function formatVND(value) {
                // Chuyển đổi thành số và sau đó định dạng
                return Number(value).toLocaleString('vi-VN') + '₫';
            }

            // Cập nhật hiển thị khi người dùng kéo thanh trượt
            if(priceRange && priceValue) {
                priceRange.addEventListener('input', function () {
                    priceValue.textContent = formatVND(this.value);
                });
            }
        });

        // Bạn có thể giữ lại hàm toggleIcon nếu cần
        function toggleIcon(button) { ... }
    </script>
}